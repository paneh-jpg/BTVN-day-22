<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M√¥ ph·ªèng ProductService</title>
    <style>
      :root {
        --bg: #020617;
        --bg-soft: #020617;
        --card: #020617;
        --accent: #f97316;
        --accent-soft: rgba(249, 115, 22, 0.12);
        --text: #e5e7eb;
        --muted: #9ca3af;
        --border: #1f2937;
        --green: #22c55e;
        --blue: #38bdf8;
        --radius: 14px;
        --shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
        --danger: #f97373;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 32px 16px 48px;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #1f2937 0, #020617 52%),
          radial-gradient(circle at bottom, #020617 0, #000 60%);
        color: var(--text);
      }

      .page {
        max-width: 1150px;
        margin: 0 auto;
      }

      h1 {
        font-size: 28px;
        text-align: center;
        margin: 0 0 8px;
        letter-spacing: 0.03em;
      }

      .subtitle {
        text-align: center;
        color: var(--muted);
        margin-bottom: 24px;
        font-size: 14px;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        padding: 4px 10px;
        font-size: 11px;
        background: rgba(56, 189, 248, 0.16);
        color: #7dd3fc;
        border: 1px solid rgba(56, 189, 248, 0.5);
      }

      .layout {
        display: grid;
        grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
        gap: 20px;
        align-items: flex-start;
      }

      @media (max-width: 950px) {
        .layout {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .card {
        background: radial-gradient(circle at top left, #020617, #020617 60%);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        padding: 18px 18px 20px;
        box-shadow: var(--shadow);
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: radial-gradient(
            circle at top right,
            rgba(249, 115, 22, 0.18),
            transparent 55%
          ),
          radial-gradient(
            circle at bottom left,
            rgba(59, 130, 246, 0.2),
            transparent 55%
          );
        opacity: 0.9;
      }

      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
        position: relative;
        z-index: 1;
      }

      .card-title {
        font-size: 16px;
        font-weight: 600;
      }

      .card-sub {
        font-size: 12px;
        color: var(--muted);
      }

      .table-wrapper {
        margin-top: 10px;
        border-radius: 10px;
        border: 1px solid rgba(31, 41, 55, 0.9);
        overflow: hidden;
        background: rgba(15, 23, 42, 0.98);
        position: relative;
        z-index: 1;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      }

      thead {
        background: rgba(15, 23, 42, 1);
      }

      th,
      td {
        padding: 6px 10px;
        text-align: left;
        border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      }

      th {
        font-weight: 600;
        font-size: 12px;
        color: #9ca3af;
      }

      tbody tr:nth-child(odd) td {
        background: rgba(15, 23, 42, 0.9);
      }

      tbody tr:nth-child(even) td {
        background: rgba(15, 23, 42, 0.7);
      }

      .pill {
        display: inline-flex;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 11px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        color: #e5e7eb;
      }

      .pill.elec {
        border-color: rgba(59, 130, 246, 0.9);
        background: rgba(37, 99, 235, 0.22);
      }

      .pill.cloth {
        border-color: rgba(244, 114, 182, 0.9);
        background: rgba(219, 39, 119, 0.25);
      }

      .price {
        font-variant-numeric: tabular-nums;
      }

      /* Row highlight states */
      .row-current td {
        background: rgba(250, 204, 21, 0.16) !important;
        transition: background 0.3s ease;
      }
      .row-pass td {
        background: rgba(34, 197, 94, 0.16) !important;
      }
      .row-fail td {
        background: rgba(248, 113, 113, 0.16) !important;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 6px 0 12px;
        position: relative;
        z-index: 1;
      }

      .btn {
        border-radius: 999px;
        border: 1px solid rgba(55, 65, 81, 0.9);
        background: radial-gradient(circle at top, #111827, #020617);
        color: var(--text);
        font-size: 12px;
        padding: 7px 13px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: 0.18s ease;
      }

      .btn span.icon {
        font-size: 13px;
      }

      .btn.primary {
        background: linear-gradient(135deg, #f97316, #facc15);
        color: #111827;
        border-color: transparent;
        font-weight: 600;
      }

      .btn:hover:not(.disabled) {
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.9);
      }

      .btn.disabled {
        opacity: 0.5;
        cursor: default;
        box-shadow: none;
      }

      .explanation {
        font-size: 12px;
        color: var(--muted);
        line-height: 1.6;
        margin-top: 4px;
        position: relative;
        z-index: 1;
      }

      .explanation code {
        background: rgba(15, 23, 42, 1);
        padding: 2px 6px;
        border-radius: 6px;
        border: 1px solid rgba(55, 65, 81, 0.9);
        font-size: 11px;
      }

      .result-block {
        margin-top: 10px;
        border-radius: 10px;
        border: 1px dashed rgba(75, 85, 99, 0.9);
        padding: 10px;
        background: rgba(15, 23, 42, 0.98);
        min-height: 64px;
        font-size: 13px;
        position: relative;
        z-index: 1;
      }

      .result-title {
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 6px;
      }

      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .chip {
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid rgba(55, 65, 81, 0.9);
        font-size: 11px;
        background: rgba(15, 23, 42, 1);
        opacity: 0;
        transform: translateY(6px);
        animation: chipIn 0.35s forwards;
      }

      @keyframes chipIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .total-value {
        font-size: 22px;
        font-weight: 700;
        color: var(--green);
      }

      .total-steps {
        font-size: 12px;
        color: var(--muted);
        margin-top: 6px;
        font-family: "Fira Code", monospace;
        white-space: pre-wrap;
      }

      .total-step-line {
        opacity: 0;
        transform: translateY(4px);
        animation: stepIn 0.3s forwards;
      }

      @keyframes stepIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .group-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
      }

      .group-card {
        background: radial-gradient(circle at top, #020617, #020617);
        border-radius: 10px;
        border: 1px solid rgba(55, 65, 81, 0.9);
        padding: 8px 9px;
      }

      .group-card h4 {
        font-size: 12px;
        margin: 0 0 4px;
        color: var(--blue);
      }

      .group-card ul {
        list-style: none;
        padding: 0;
        margin: 0;
        font-size: 12px;
        color: #e5e7eb;
      }

      .group-card li {
        padding: 2px 0;
        display: flex;
        justify-content: space-between;
        gap: 6px;
        opacity: 0;
        transform: translateY(4px);
        animation: stepIn 0.3s forwards;
      }

      .code-block {
        background: rgba(15, 23, 42, 1);
        border-radius: 10px;
        border: 1px solid rgba(55, 65, 81, 0.9);
        padding: 10px 12px;
        font-family: "Fira Code", monospace;
        font-size: 12px;
        white-space: pre;
        color: #e5e7eb;
        position: relative;
        z-index: 1;
        margin-top: 12px;
      }

      .code-block .kw {
        color: #f97316;
      }
      .code-block .id {
        color: #38bdf8;
      }
      .code-block .str {
        color: #facc15;
      }
      .code-block .num {
        color: #a5b4fc;
      }
      .code-block .fn {
        color: #4ade80;
      }
      .code-block .comment {
        color: #6b7280;
      }

      footer {
        text-align: center;
        margin-top: 34px;
        color: var(--muted);
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="page">
      <span class="badge">Visualization ‚Ä¢ filter + reduce + groupBy</span>
      <h1>M√¥ ph·ªèng t·ª´ng b∆∞·ªõc ho·∫°t ƒë·ªông c·ªßa <code>ProductService</code></h1>
      <p class="subtitle">
        Nh√¨n t·ª´ng s·∫£n ph·∫©m ƒë∆∞·ª£c duy·ªát, l·ªçc, c·ªông d·ªìn v√† nh√≥m l·∫°i theo
        <code>category</code> v·ªõi animation tr·ª±c quan.
      </p>

      <div class="layout">
        <!-- C·ªòT TR√ÅI: D·ªÆ LI·ªÜU G·ªêC + CODE -->
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                D·ªØ li·ªáu g·ªëc: m·∫£ng <code>products</code>
              </div>
              <div class="card-sub">
                ƒê√¢y l√† danh s√°ch s·∫£n ph·∫©m m√† <code>ProductService</code> s·∫Ω x·ª≠
                l√Ω.
              </div>
            </div>
          </div>

          <div class="table-wrapper" id="productsTable"></div>

          <div style="margin-top: 14px; position: relative; z-index: 1">
            <div class="card-title" style="margin-bottom: 4px">
              Code l·ªõp <code>ProductService</code>
            </div>
            <div class="code-block">
              <span class="kw">class</span>
              <span class="id">ProductService</span> {
              <span class="kw">constructor</span>(products) {
              <span class="kw">this</span>.<span class="id">products</span> =
              products; }

              <span class="fn">filterElectronics</span>() {
              <span class="kw">return</span> <span class="kw">this</span>.<span
                class="id"
                >products</span
              >.<span class="fn">filter</span>( (<span class="id">product</span
              >) =&gt; <span class="id">product</span>.<span class="id"
                >category</span
              >
              === <span class="str">"Electronics"</span>
              ); }

              <span class="fn">totalElectronicsPrice</span>() {
              <span class="kw">return</span> <span class="kw">this</span>.<span
                class="fn"
                >filterElectronics</span
              >().<span class="fn">reduce</span>( (<span class="id">total</span
              >, <span class="id">product</span>) =&gt;
              <span class="id">total</span> +
              <span class="id">product</span>.<span class="id">price</span>,
              <span class="num">0</span>
              ); }

              <span class="fn">groupByCategory</span>() {
              <span class="kw">return</span> <span class="kw">this</span>.<span
                class="id"
                >products</span
              >.<span class="fn">reduce</span>((<span class="id">acc</span>,
              <span class="id">product</span>) =&gt; {
              <span class="kw">const</span> <span class="id">category</span> =
              <span class="id">product</span>.<span class="id">category</span>;
              <span class="kw">if</span> (!<span class="id">acc</span>[<span
                class="id"
                >category</span
              >]) { <span class="id">acc</span>[<span class="id">category</span
              >] = []; } <span class="id">acc</span>[<span class="id"
                >category</span
              >].<span class="fn">push</span>(<span class="id">product</span>);
              <span class="kw">return</span> <span class="id">acc</span>; },
              {}); } }
            </div>
          </div>
        </div>

        <!-- C·ªòT PH·∫¢I: ANIMATION T·ª™NG B∆Ø·ªöC -->
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">M√¥ ph·ªèng t·ª´ng b∆∞·ªõc c√°c ph∆∞∆°ng th·ª©c</div>
              <div class="card-sub">
                L·∫ßn l∆∞·ª£t xem filter ‚Üí reduce (t√≠nh t·ªïng) ‚Üí reduce (groupBy) ho·∫°t
                ƒë·ªông nh∆∞ th·∫ø n√†o.
              </div>
            </div>
          </div>

          <div class="controls">
            <button class="btn primary" id="btnRunAll">
              <span class="icon">‚ö°</span> Ch·∫°y t·ª´ng b∆∞·ªõc to√†n b·ªô
            </button>
            <button class="btn" id="btnStepFilter">
              <span class="icon">üéØ</span> Ch·ªâ filterElectronics()
            </button>
            <button class="btn" id="btnStepTotal">
              <span class="icon">‚ûï</span> Ch·ªâ totalElectronicsPrice()
            </button>
            <button class="btn" id="btnStepGroup">
              <span class="icon">üóÇ</span> Ch·ªâ groupByCategory()
            </button>
          </div>

          <div class="explanation">
            <strong>C√°ch xem animation:</strong><br />
            ‚Äì H√†ng trong b·∫£ng ƒë∆∞·ª£c
            <span style="color: #eab308">t√¥ v√†ng</span> l√† s·∫£n ph·∫©m ƒëang ƒë∆∞·ª£c x·ª≠
            l√Ω.<br />
            ‚Äì V·ªõi <code>filterElectronics()</code>, h√†ng m√†u xanh l√° l√† ƒë∆∞·ª£c gi·ªØ
            l·∫°i, ƒë·ªè l√† b·ªã l·ªçc b·ªè.<br />
            ‚Äì Khi nh√≥m, b·∫°n s·∫Ω th·∫•y t·ª´ng s·∫£n ph·∫©m ‚Äúxu·∫•t hi·ªán‚Äù d·∫ßn trong kh·ªëi
            <code>groupByCategory()</code>.
          </div>

          <!-- K·∫øt qu·∫£ filter -->
          <div class="result-block" id="resultFilter">
            <div class="result-title">
              1Ô∏è‚É£ K·∫øt qu·∫£ <code>filterElectronics()</code> ‚Äì ch·ªâ gi·ªØ l·∫°i
              Electronics:
            </div>
            <div class="chips" id="filterChips"></div>
          </div>

          <!-- K·∫øt qu·∫£ total -->
          <div class="result-block" id="resultTotal">
            <div class="result-title">
              2Ô∏è‚É£ K·∫øt qu·∫£ <code>totalElectronicsPrice()</code> ‚Äì c·ªông d·ªìn gi√°
              Electronics:
            </div>
            <div id="totalValue" class="total-value"></div>
            <div id="totalSteps" class="total-steps"></div>
          </div>

          <!-- K·∫øt qu·∫£ group -->
          <div class="result-block" id="resultGroup">
            <div class="result-title">
              3Ô∏è‚É£ K·∫øt qu·∫£ <code>groupByCategory()</code> ‚Äì gom l·∫°i theo
              <code>category</code>:
            </div>
            <div id="groupGrid" class="group-grid"></div>
          </div>
        </div>
      </div>

      <footer>¬© Demo ProductService ‚Äì visualization by ChatGPT</footer>
    </div>

    <script>
      // D·ªÆ LI·ªÜU G·ªêC
      const products = [
        { id: 1, name: "Laptop", category: "Electronics", price: 1200 },
        { id: 2, name: "Phone", category: "Electronics", price: 800 },
        { id: 3, name: "Shirt", category: "Clothing", price: 40 },
        { id: 4, name: "Shoes", category: "Clothing", price: 60 },
        { id: 5, name: "Headphones", category: "Electronics", price: 150 },
      ];

      class ProductService {
        constructor(products) {
          this.products = products;
        }

        filterElectronics() {
          return this.products.filter(
            (product) => product.category === "Electronics"
          );
        }

        totalElectronicsPrice() {
          return this.filterElectronics().reduce(
            (total, product) => total + product.price,
            0
          );
        }

        groupByCategory() {
          return this.products.reduce((acc, product) => {
            const category = product.category;
            if (!acc[category]) {
              acc[category] = [];
            }
            acc[category].push(product);
            return acc;
          }, {});
        }
      }

      const service = new ProductService(products);

      // Render b·∫£ng d·ªØ li·ªáu g·ªëc
      const productsTable = document.getElementById("productsTable");

      function renderProductsTable() {
        const html = `
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>T√™n s·∫£n ph·∫©m</th>
            <th>Danh m·ª•c</th>
            <th>Gi√° ($)</th>
          </tr>
        </thead>
        <tbody>
          ${products
            .map((p) => {
              const pillClass =
                p.category === "Electronics" ? "pill elec" : "pill cloth";
              return `
                <tr data-id="${p.id}">
                  <td>${p.id}</td>
                  <td>${p.name}</td>
                  <td><span class="${pillClass}">${p.category}</span></td>
                  <td class="price">${p.price.toFixed(2)}</td>
                </tr>
              `;
            })
            .join("")}
        </tbody>
      </table>
    `;
        productsTable.innerHTML = html;
      }

      renderProductsTable();

      const filterChips = document.getElementById("filterChips");
      const totalValueEl = document.getElementById("totalValue");
      const totalStepsEl = document.getElementById("totalSteps");
      const groupGrid = document.getElementById("groupGrid");

      const btnRunAll = document.getElementById("btnRunAll");
      const btnStepFilter = document.getElementById("btnStepFilter");
      const btnStepTotal = document.getElementById("btnStepTotal");
      const btnStepGroup = document.getElementById("btnStepGroup");

      function delay(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      function resetRowClasses() {
        document.querySelectorAll("tbody tr").forEach((row) => {
          row.classList.remove("row-current", "row-pass", "row-fail");
        });
      }

      function setButtonsDisabled(disabled) {
        const btns = [btnRunAll, btnStepFilter, btnStepTotal, btnStepGroup];
        btns.forEach((b) => {
          if (disabled) {
            b.classList.add("disabled");
            b.disabled = true;
          } else {
            b.classList.remove("disabled");
            b.disabled = false;
          }
        });
      }

      async function animateFilterElectronics() {
        resetRowClasses();
        filterChips.innerHTML = "";

        for (const p of products) {
          const row = document.querySelector(`tr[data-id="${p.id}"]`);
          row.classList.add("row-current");
          await delay(600);

          if (p.category === "Electronics") {
            row.classList.remove("row-current");
            row.classList.add("row-pass");

            const chip = document.createElement("div");
            chip.className = "chip";
            chip.textContent = `${p.name} ‚Äì $${p.price}`;
            filterChips.appendChild(chip);
          } else {
            row.classList.remove("row-current");
            row.classList.add("row-fail");
          }

          await delay(400);
        }
      }

      async function animateTotalElectronicsPrice() {
        // D√πng k·∫øt qu·∫£ c·ªßa filterElectronics nh∆∞ng c≈©ng gi·∫£i th√≠ch t·ª´ng b∆∞·ªõc
        const electronics = service.filterElectronics();
        let total = 0;
        totalValueEl.textContent = "";
        totalStepsEl.innerHTML = "";

        for (const p of electronics) {
          const prev = total;
          total += p.price;
          const line = document.createElement("div");
          line.className = "total-step-line";
          line.textContent = `${prev} + ${p.price} = ${total}`;
          totalStepsEl.appendChild(line);
          await delay(600);
        }

        await delay(300);
        totalValueEl.textContent = `$${total.toFixed(2)}`;
      }

      async function animateGroupByCategory() {
        groupGrid.innerHTML = "";
        // t·∫°o card nh√≥m r·ªóng
        const grouped = {};
        for (const p of products) {
          if (!grouped[p.category]) {
            grouped[p.category] = [];
          }
        }
        Object.keys(grouped).forEach((cat) => {
          const div = document.createElement("div");
          div.className = "group-card";
          div.innerHTML = `<h4>${cat}</h4><ul></ul>`;
          groupGrid.appendChild(div);
        });

        resetRowClasses();

        const acc = {};
        for (const p of products) {
          const row = document.querySelector(`tr[data-id="${p.id}"]`);
          row.classList.add("row-current");
          await delay(500);

          const category = p.category;
          if (!acc[category]) {
            acc[category] = [];
          }
          acc[category].push(p);

          const card = [...document.querySelectorAll(".group-card")].find(
            (c) => c.querySelector("h4").textContent === category
          );
          const ul = card.querySelector("ul");
          const li = document.createElement("li");
          li.innerHTML = `<span>${p.name}</span><span>$${p.price}</span>`;
          ul.appendChild(li);

          row.classList.remove("row-current");
          row.classList.add("row-pass");
          await delay(500);
        }
      }

      // G√°n s·ª± ki·ªán
      btnStepFilter.addEventListener("click", async () => {
        if (btnStepFilter.disabled) return;
        setButtonsDisabled(true);
        await animateFilterElectronics();
        setButtonsDisabled(false);
      });

      btnStepTotal.addEventListener("click", async () => {
        if (btnStepTotal.disabled) return;
        setButtonsDisabled(true);
        await animateTotalElectronicsPrice();
        setButtonsDisabled(false);
      });

      btnStepGroup.addEventListener("click", async () => {
        if (btnStepGroup.disabled) return;
        setButtonsDisabled(true);
        await animateGroupByCategory();
        setButtonsDisabled(false);
      });

      btnRunAll.addEventListener("click", async () => {
        if (btnRunAll.disabled) return;
        setButtonsDisabled(true);
        await animateFilterElectronics();
        await animateTotalElectronicsPrice();
        await animateGroupByCategory();
        setButtonsDisabled(false);
      });

      // Kh·ªüi t·∫°o k·∫øt qu·∫£ tƒ©nh ban ƒë·∫ßu (kh√¥ng animation) n·∫øu mu·ªën:
      (function initStatic() {
        const electronics = service.filterElectronics();
        filterChips.innerHTML = electronics
          .map(
            (p) =>
              `<div class="chip" style="opacity:1;transform:none">${p.name} ‚Äì $${p.price}</div>`
          )
          .join("");

        const total = service.totalElectronicsPrice();
        totalValueEl.textContent = `$${total.toFixed(2)}`;

        const grouped = service.groupByCategory();
        groupGrid.innerHTML = Object.keys(grouped)
          .map((cat) => {
            const list = grouped[cat]
              .map(
                (p) =>
                  `<li style="opacity:1;transform:none"><span>${p.name}</span><span>$${p.price}</span></li>`
              )
              .join("");
            return `
          <div class="group-card">
            <h4>${cat}</h4>
            <ul>${list}</ul>
          </div>
        `;
          })
          .join("");
      })();
    </script>
  </body>
</html>
